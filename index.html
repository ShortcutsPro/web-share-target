<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="utf-8">
    <title>
      Web Share Target API
    </title>
    <script src="https://www.w3.org/Tools/respec/respec-w3c-common" class=
    "remove"></script>
    <script class='remove'>
      var respecConfig = {
        specStatus: "CG-DRAFT",
        edDraftURI: "https://wicg.github.io/web-share-target/",
        github: {
          repoURL: "https://github.com/WICG/web-share-target/",
          branch: "master"
        },
        shortName: "web-share-target",
        processVersion: 2017,
        wg: "Web Incubator Community Group",
        wgURI: "https://wicg.io",
        editors: [{
          name: "Matt Giuca",
          company: "Google Inc.",
          companyURL: "https://google.com"
        }],
        otherLinks: [{
          key: "Implementation status",
          data: [{
            value: "Chromium",
            href: "https://www.chromestatus.com/features/5662315307335680"
          }]
        }],
        localBiblio: {
          "WebShare": {
            id: "WebShare",
            title: "Web Share API",
            href: "https://wicg.github.io/web-share",
            authors: [
              "Matt Giuca",
            ],
            status: "Draft Report",
            publisher: "WICG"
          }
        }
      };
    </script>
  </head>
  <body>
    <section id="abstract">
      <p>
        This specification defines an API that allows websites to receive
        shared content from either the <a data-cite="!WebShare">Web Share
        API</a>, or system events (e.g., shares from native apps).
      </p>
      <p>
        This API requires the user agent to support <a data-cite=
        "!appmanifest">web app manifests</a>. The <a data-cite="!WebShare">Web
        Share API</a> is not required, but recommended.
      </p>
    </section>
    <section id="sotd">
      <p>
        This is an early draft of the Web Share Target spec.
      </p>
    </section>
    <section class="informative">
      <h2>
        Usage Examples
      </h2>
      <p>
        TODO: Usage Examples
      </p>
      <p>
        How the handler deals with the data object is at the handler's
        discretion, and will generally depend on the type of app. Here are some
        suggestions:
      </p>
      <ul>
        <li>An email client might draft a new email, using <code>title</code>
        as the subject of an email, with <code>text</code> and <code>url</code>
        concatenated together as the body.
        </li>
        <li>A social networking app might draft a new post, ignoring
        <code>title</code>, using <code>text</code> as the body of the message
        and adding <code>url</code> as a link. If <code>text</code> is missing,
        it might use <code>url</code> in the body as well. If <code>url</code>
        is missing, it might scan <code>text</code> looking for a URL and add
        that as a link.
        </li>
        <li>A text messaging app might draft a new message, ignoring
        <code>title</code> and using <code>text</code> and <code>url</code>
        concatenated together. It might truncate the text or replace
        <code>url</code> with a short link to fit into the message size.
        </li>
      </ul>
    </section>
    <section>
      <h2>
        Extension to the Web App Manifest
      </h2>
      <p>
        The first thing a handler needs to do is declare its share handling
        capabilities in its <a data-cite="!appmanifest">web app manifest</a>:
      </p>
      <p>
        We expect apps that are sharing data to share one or more fields,
        including title, text, and URL. These fields can be passed to the
        target app as query parameters, and each is optional. If a web app can
        handle a share, they should include (in the manifest) a template URL
        (relative to the manifest URL) that the shared data can be inserted
        into.
      </p>
      <pre class="idl">
dictionary ShareTarget {
  DOMString url_template;
};

partial dictionary WebAppManifest {
  ShareTarget share_target;
};
</pre>
      <div class="note">
        The above IDL extends the <dfn>WebAppManifest</dfn> dictionary from the
        Web App Manifest spec. Currently, the manifest is defined as a set of
        algorithms, not an IDL dictionary, but this is being discussed in
        <a href="https://github.com/w3c/manifest/issues/611">manifest#611</a>.
        Assume <code>WebAppManifest</code> is defined as in the PR <a href=
        "https://github.com/w3c/manifest/issues/613">manifest#613</a>.
      </div>
      <p>
        TODO: Define the extension point as it would appear in the Web App
        Manifest.
      </p>
      <p>
        The <dfn>ShareTarget</dfn> dictionary defines the members of the
        <dfn for="WebAppManifest">share_target</dfn> member of the manifest.
      </p>
      <p data-dfn-for="ShareTarget">
        The <dfn>url_template</dfn> member will contain placeholders for each
        field of the form "{field}". Each placeholder in the template will be
        replaced with the value of the corresponding field, that has been
        shared by the source app. If a given field was not shared, its
        placeholder will be replaced with an empty string. An example url
        template is here:
      </p>
      <pre class="example json">
"share_target": {
  "url_template": "/share?title={title}&amp;text={text}&amp;url={url}"
}
</pre>
      <p>
        The <a for="ShareTarget">url_template</a> member also allows the target
        web app to specify which attributes of the shared data it cares about.
        e.g. for Web Share, the passed data includes title, text, and URL, but
        the receiving web app may only care about message and URL.
      </p>
      <section>
        <h3>
          <code>share_target</code> member
        </h3>
        <p>
          TODO: Define the <code>share_target</code> member as it would be
          written in the Manifest spec.
        </p>
      </section>
      <section>
        <h3>
          Things to note
        </h3>
        <p>
          The declarative nature of the manifest allows search services to
          index and present web applications that handle shares.
        </p>
        <p>
          Handlers declaring <code>share_target</code> in their manifest will
          <strong>not</strong> be automatically registered; the user must
          explicitly authorize the registration. How this takes place is still
          under consideration (see <a href="docs/explainer.md#user-flow">User
          Flow</a>, but will ultimately be at the discretion of the user agent
          (the user may be automatically prompted, or may have to explicitly
          request registration).
        </p>
        <p class="note">
          <strong>For consideration</strong>: We may wish to provide a method
          for websites to explicitly request to prompt the user for handler
          registration. There would still be a requirement to declare
          <code>supports_share</code> in the manifest. For now, we have omitted
          such a method from the design to keep control in the hands of user
          agents. It is easier to add such a method later than remove it.
        </p>
      </section>
    </section>
    <section>
      <h2>
        Handling incoming shares
      </h2>
      <p>
        Share events can be sent from a variety of places:
      </p>
      <ul>
        <li>Built-in trigger (e.g., user picks "Share" from a browser's menu,
        to share the URL in the address bar).
        </li>
        <li>A native application.
        </li>
        <li>A web application using the <a data-cite="!WebShare">Web Share
        API</a>.
        </li>
      </ul>
      <p>
        There will usually be a picker that lets the user select a target app.
        This could be the native system app picker, or a user-agent-supplied
        picker. The apps could include other system apps and actions alongside
        the web app handlers.
      </p>
      <p>
        If an event comes from a web app, the <code>data</code> field of the
        event should be a clone of the <code>data</code> parameter to
        <code>navigator.share</code>. If the event comes from some other
        source, the user agent may construct the <code>data</code> object as
        appropriate.
      </p>
      <p>
        Recall the URL template from Example 1:
      </p>
      <pre>
/share?title={title}&amp;text={text}&amp;url={url}
</pre>
      <p>
        This will be filled with the share data, and opened by the browser,
        when the user selects the target app.
      </p>
      <p>
        For example, if a source app shares the data:
      </p>
      <pre class="example json">
{
  "title": "Web Share Target API",
  "text": "An API that allows web apps to receive shared data",
  "url": "https://github.com/WICG/web-share-target"
}
</pre>
      <p>
        The browser will then launch the picker UI, and the user picks some
        target app. If the target app is www.example.com, the browser will
        launch the following URL in a new window or tab:
      </p>
      <pre>
https://www.example.com/share?title=Web%20Share%20Target%20API&amp;text=An%20API%20that%20allows%20web%20apps%20to%20receive%20shared%20data&amp;url=https://github.com/WICG/web-share-target
</pre>
      <p>
        Thus, the receiving web app should handle the shared data as desired,
        at that URL.
      </p>
    </section>
    <section class="informative">
      <h2>
        Security and privacy considerations
      </h2>
      <p>
        TODO: Security and privacy considerations.
      </p>
    </section>
    <section class="appendix informative">
      <h2>
        Acknowledgments
      </h2>
      <p>
        Thanks to the <a data-cite="web-intents">Web Intents</a> team, who laid
        the groundwork for the web app interoperability use cases. In
        particular, <a href="https://paul.kinlan.me/">Paul Kinlan</a>, who did
        a lot of early advocacy for Web Share and Web Share Target.
      </p>
      <p>
        Thanks to Connie Pyromallis, who wrote an early draft of this spec, and
        helped design and prototype the API.
      </p>
    </section>
  </body>
</html>
